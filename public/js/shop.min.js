function checkParams(){const e=window.location.pathname,t=window.location.search,o=new URLSearchParams(t);"/shop"!==e&&updateForm.classList.add("d-none"),""!==t&&(sortSelect.value=o.get("sortby"),filterSelect.value=o.get("filterby"))}function checkFavorites(e){e.forEach(e=>{favorites.includes(e.id)&&e.setAttribute("src","assets/liked.svg")})}function addToCart(e,t){var o;t=JSON.parse(t),fetch("/product",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e})}).then(e=>e.json()).then(e=>{o=e;const n=JSON.parse(localStorage.getItem("cartItems"))||[],r=document.querySelectorAll(".cart"),a=n.filter(e=>e.id===o._id),s=a.find(e=>e.option===t.name);if(s)if(s.option===t.name)s.quantity+=1;else{const e={id:o._id,name:o.name,image:o.image,type:o.type,min:o.min,max:o.max,option:t.name,price:Number(t.price),quantity:1};n.push(e),r.forEach(e=>e.innerHTML=n.length)}else{const e={id:o._id,name:o.name,image:o.image,type:o.type,min:o.min,max:o.max,option:t.name,price:Number(t.price),quantity:1};n.push(e),r.forEach(e=>{e.classList.remove("d-none"),e.innerHTML=n.length})}localStorage.setItem("cartItems",JSON.stringify(n))})}function addToFavorites(e,t){const o=document.querySelectorAll(".fav");let n=JSON.parse(localStorage.getItem("favorites"))||[];const r=n.findIndex(e=>e===t);r<0?(n.push(t),e.target.setAttribute("src","assets/liked.svg")):(n.splice(r,1),e.target.setAttribute("src","assets/favorite.svg")),o.forEach(e=>{e.classList.remove("d-none"),0===n.length?e.innerHTML="":e.innerHTML=n.length}),localStorage.setItem("favorites",JSON.stringify(n))}function showItem(e){const t=document.querySelector(".item-title"),o=document.querySelector(".quickview-img"),n=document.querySelector(".item-price"),r=document.querySelector("#options"),a=document.querySelector(".add-to-cart"),s=document.querySelector("#price");a.setAttribute("id",e),a.value="",r.innerHTML="",s.innerHTML="",fetch("/product",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e})}).then(e=>e.json()).then(e=>{loader.classList.add("d-none"),productData.classList.remove("d-none"),t.innerHTML=e.name,o.setAttribute("src",e.image),null===e.max?n.innerHTML=`$${e.min}`:n.innerHTML=`$${e.min} - $${e.max}`,e.options.forEach(e=>{const t=`\n            <button type="button" id="${e.name}" value="${e.price}" class="btn px-4 py-1 btn-outline-dark rounded-0 border-2" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="option 1">\n                ${e.name}\n            </button>`;r.innerHTML+=t;const o=document.querySelectorAll("#options button");o.forEach(e=>{e.addEventListener("click",()=>{o.forEach(t=>{t!==e&&(error.classList.add("d-none"),t.classList.remove("btn-dark","selected"),t.classList.add("btn-outline-dark"))}),a.value=JSON.stringify({price:e.value,name:e.id}),e.classList.remove("btn-outline-dark"),e.classList.add("btn-dark","selected"),s.innerHTML=`$${e.value}`})})})}).catch(e=>console.error(e))}function sort(e){const t=e.target.value;switch(history.pushState({},"",`/shop?sortby=${t}`),t){case"latest":case"low":case"high":fetchItems("sortby="+t);break;default:history.pushState({},"","/shop"),fetchItems(t)}}function filter(e){const t=e.target.value;switch(history.pushState({},"",`/shop?sortby=${t}`),t){case"latest":case"low":case"high":fetchItems("sortby="+t);break;default:history.pushState({},"","/shop"),fetchItems(t)}}function fetchItems(e){fetch(`/shop?${e}&update=true`,{method:"GET"}).then(e=>e.text()).then(e=>{const t=document.querySelector(".product-container");t.innerHTML=e}).catch(e=>{console.error(e)})}const toggleBtns=document.querySelectorAll(".show-btn"),offcanvas=document.querySelector(".drawer"),closeBtn=document.querySelector(".drawer-closer"),overlay=document.querySelector(".overlay"),addBtn=document.querySelector(".add-to-cart"),favIcons=document.querySelectorAll(".fav-icon"),favorites=JSON.parse(localStorage.getItem("favorites"))||[],error=document.querySelector("#option-error"),updaters=document.querySelectorAll(".form-select"),filterSelect=document.querySelector("#filter"),sortSelect=document.querySelector("#sort"),productData=document.querySelector(".product-data"),loader=document.querySelector(".spinner-container"),loadMoreBtn=document.querySelector(".more-btn"),prodLayout=document.querySelector(".product-layout");var updateForm;"/shop"===window.location.pathname&&(updateForm=document.querySelector("#update-form"),checkParams()),"/search"===window.location.pathname&&(updateForm=document.querySelector("#update-form"),loadMoreBtn.classList.add("d-none"),updateForm.classList.add("d-none"),0===prodLayout.children.length&&(prodLayout.innerHTML='\n        <div class="row m-0 gy-4 ">\n            <div class="d-flex gap-3 flex-column justify-content-center align-items-center">\n                <img height="60" src="/assets/empty-cart.svg" alt="cart is empty">\n                <p class="fs-3 fw-semibold">Nothing found !</p>\n            </div>\n        </div>\n        ')),checkFavorites(favIcons),updaters.forEach(e=>{e.addEventListener("change",function(e){updateForm.addEventListener("submit",function(e){e.preventDefault()});const t=new FormData(updateForm),o=new URLSearchParams;t.forEach((e,t)=>{e&&o.append(t,e)});const n=o.toString(),r=`${window.location.pathname}?${n}`,a=r+"&update=true";window.history.pushState(null,null,r),fetch(a).then(e=>e.text()).then(e=>{const t=document.querySelector(".product-container");t.innerHTML=e})})}),addBtn.addEventListener("click",()=>{""===addBtn.value?(error.classList.remove("d-none"),error.innerHTML="Please choose a size"):addToCart(addBtn.id,addBtn.value)}),toggleBtns.forEach(e=>e.addEventListener("click",function(){offcanvas.classList.add("reveal"),overlay.classList.add("reveal"),document.body.style.overflow="hidden"})),closeBtn.addEventListener("click",function(){offcanvas.classList.remove("reveal"),overlay.classList.remove("reveal"),error.classList.add("d-none"),document.body.style.overflow="auto"}),offcanvas.addEventListener("transitionend",()=>{offcanvas.classList.contains("reveal")||(productData.classList.add("d-none"),loader.classList.remove("d-none"))}),overlay.addEventListener("click",function(){offcanvas.classList.remove("reveal"),overlay.classList.remove("reveal"),error.classList.add("d-none"),document.body.style.overflow="auto"});